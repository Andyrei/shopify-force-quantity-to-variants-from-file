{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="card">
    <h2>Select Store</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1em; margin-top: 1em;">
        {% for store_id, store_config in stores.items() %}
        <div class="store-box" 
             data-store="{{ store_config.STORE_NAME }}"
             data-store-id="{{ store_id }}">
            <h3>{{ store_config.TITLE }}</h3>
            <p style="font-size: 0.9em; color: #888;">{{ store_config.STORE_NAME }}</p>
            <span class="active-badge" style="display: none;">Active</span>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Highlight the selected store from localStorage
    document.addEventListener("DOMContentLoaded", function() {
        const selectedStore = localStorage.getItem('selectedStore');
        if (selectedStore) {
            const storeBoxes = document.querySelectorAll('.store-box');
            storeBoxes.forEach(box => {
                if (box.dataset.storeId === selectedStore) {
                    box.classList.add('active');
                    const badge = box.querySelector('.active-badge');
                    if (badge) {
                        badge.style.display = 'inline-block';
                    }
                }
            });
        }
    });
</script>

<div class="card" id="sync-config" style="display: none;">
    <h2>Missing Required Data</h2>
    <p style="color: #bdbdbd; font-size: 1.2rem; margin-bottom: 1em;">
        Please provide the missing information for this file:
    </p>
    <div style="margin-bottom: 1em;">
        <div id="location-field" style="display: none; margin-bottom: 10px;">
            <label for="location-id">Location ID (ID Sede):</label>
            <input type="text" id="location-id" placeholder="e.g. 101947474247" style="margin-left: 10px; padding: 8px; width: 200px;">
        </div>
        
        <div id="sale-channel-field" style="display: none; margin-bottom: 10px;">
            <label for="sale-channel">Sale Channel (Canale di Vendita):</label>
            <input type="text" id="sale-channel" placeholder="e.g. 176929734983" style="margin-left: 10px; padding: 8px; width: 200px;">
        </div>
        
        <button id="save-and-sync" style="display: none; margin-top: 10px; background: var(--color-primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
            Save to File & Sync
        </button>
    </div>
</div>

<div class="card" id="files-section" style="{% if not current_store %}display: none;{% endif %}">
    <h2>Uploaded Files</h2>
    <ul id="resources-list">
        <li>Loading...</li>
    </ul>
</div>

<div class="card" id="upload-section" style="{% if not current_store %}display: none;{% endif %}">
    <h2> UploadFile </h2>
    <form method="POST" action="api/v1/uploadFile" enctype="multipart/form-data" id="UploadFile" style="margin-bottom: 1em;">
        <input type="file" id="file" name="file" accept=".csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
        <button type="submit">UPLOAD</button>
    </form>
    <pre class="box" style="max-width:100%">Here should be data returned from API response</pre>
</div>

<script>
    // Pass store selection state to JavaScript
    window.storeSelected = {{ 'true' if current_store else 'false' }};
</script>

{% endblock %}